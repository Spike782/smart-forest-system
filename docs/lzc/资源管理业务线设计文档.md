# 智慧林草系统 - 资源管理业务线数据库设计全方案

## 一、用例分析

### 1. 参与者

- **系统管理员**：审核林草资源信息的新增与变更
- **数据管理员**：录入、更新、校验林草资源基础信息，维护资源变动记录
- **区域护林员**：上报负责区域内的林草资源变动情况（如新增种植、病虫害导致减少等）
- **监管人员**：核查资源变动记录的真实性与合规性

### 2. 核心用例

| 用例名称         | 参与者                     | 用例描述                                                     |
| ---------------- | -------------------------- | ------------------------------------------------------------ |
| 录入林草资源信息 | 数据管理员                 | 向系统中添加新的林草资源基础数据，包括资源类型、所属区域、品种、数量 / 面积等信息 |
| 更新资源生长状态 | 区域护林员 / 数据管理员    | 根据实际生长情况，修改林草资源的生长阶段（幼苗 / 成长期 / 成熟期），并同步更新时间 |
| 记录资源变动     | 区域护林员                 | 当资源出现数量 / 面积增减或状态变更时，录入变动类型、原因、时间及操作人信息 |
| 查询资源统计数据 | 管理员 / 监管人员 / 护林员 | 按区域、资源类型、生长状态等维度查询林草资源的汇总数据       |
| 审核资源变动记录 | 监管人员                   | 核对资源变动记录的内容，确认变动原因和操作流程的合规性       |

## 二、数据字典

### 1. 实体：林草资源信息

| 属性名称    | 数据类型 | 精度 / 长度 | 约束条件                     | 说明                                                         |
| ----------- | -------- | ----------- | ---------------------------- | ------------------------------------------------------------ |
| 资源编号    | VARCHAR  | 32          | 主键、非空、唯一             | 林草资源的唯一标识，自定义编码规则（如区域编号 + 资源类型编码 + 序号） |
| 资源类型    | VARCHAR  | 16          | 非空                         | 取值为 “树木” 或 “草地”                                      |
| 区域编号    | VARCHAR  | 32          | 非空、外键（关联区域信息表） | 资源所属区域的唯一标识                                       |
| 品种名称    | VARCHAR  | 64          | 非空                         | 林草资源的具体品种（如油松、早熟禾等）                       |
| 数量 / 面积 | DECIMAL  | 10,2        | 非空                         | 树木资源存储数量，草地资源存储面积（单位：㎡）               |
| 生长状态    | VARCHAR  | 16          | 非空                         | 取值为 “幼苗”“成长期”“成熟期”                                |
| 种植时间    | DATE     | -           | 非空                         | 资源的初始种植日期                                           |
| 更新时间    | DATETIME | -           | 非空                         | 资源信息最后一次更新的时间，自动同步系统时间                 |

### 2. 实体：资源变动记录

| 属性名称  | 数据类型 | 精度 / 长度 | 约束条件                         | 说明                                                     |
| --------- | -------- | ----------- | -------------------------------- | -------------------------------------------------------- |
| 变动编号  | VARCHAR  | 32          | 主键、非空、唯一                 | 资源变动记录的唯一标识                                   |
| 资源编号  | VARCHAR  | 32          | 非空、外键（关联林草资源信息表） | 发生变动的资源标识                                       |
| 变动类型  | VARCHAR  | 16          | 非空                             | 取值为 “新增”“减少”“状态更新”                            |
| 变动原因  | VARCHAR  | 255         | 非空                             | 记录资源变动的具体原因（如人工补种、自然灾害、病虫害等） |
| 变动时间  | DATETIME | -           | 非空                             | 资源变动发生的时间                                       |
| 操作人 ID | VARCHAR  | 32          | 非空、外键（关联用户信息表）     | 执行变动操作的人员 ID                                    |

### 3. 关联实体：区域信息（复用环境监测业务线实体）

| 属性名称  | 数据类型 | 精度 / 长度 | 约束条件                     | 说明                |
| --------- | -------- | ----------- | ---------------------------- | ------------------- |
| 区域编号  | VARCHAR  | 32          | 主键、非空、唯一             | 区域唯一标识        |
| 区域名称  | VARCHAR  | 64          | 非空                         | 区域名称            |
| 区域类型  | VARCHAR  | 16          | 非空                         | 取值为 “森林”“草地” |
| 地理位置  | VARCHAR  | 64          | 非空                         | 经纬度信息          |
| 负责人 ID | VARCHAR  | 32          | 非空、外键（关联用户信息表） | 区域护林员 ID       |

### 4. 关联实体：用户信息（复用系统通用实体）

| 属性名称 | 数据类型 | 精度 / 长度 | 约束条件         | 说明                                   |
| -------- | -------- | ----------- | ---------------- | -------------------------------------- |
| 用户 ID  | VARCHAR  | 32          | 主键、非空、唯一 | 系统用户唯一标识                       |
| 用户名   | VARCHAR  | 32          | 非空、唯一       | 登录账号                               |
| 角色     | VARCHAR  | 16          | 非空             | 关联系统角色（如护林员、数据管理员等） |

## 三、逻辑结构设计（关系模式，满足第三范式）

1. **区域信息表（t_area）**
   - 关系模式：t_area (区域编号，区域名称，区域类型，地理位置，负责人 ID)
   - 主键：区域编号；外键：负责人 ID（关联 t_user）
2. **用户信息表（t_user）**
   - 关系模式：t_user (用户 ID, 用户名，角色，密码，联系方式)
   - 主键：用户 ID；唯一约束：用户名
3. **林草资源信息表（t_forest_grass_resource）**
   - 关系模式：t_forest_grass_resource (资源编号，资源类型，区域编号，品种名称，数量_面积，生长状态，种植时间，更新时间)
   - 主键：资源编号；外键：区域编号（关联 t_area）
4. **资源变动记录表（t_resource_change）**
   - 关系模式：t_resource_change (变动编号，资源编号，变动类型，变动原因，变动时间，操作人 ID)
   - 主键：变动编号；外键：资源编号（关联 t_forest_grass_resource）、操作人 ID（关联 t_user）

## 四、物理结构设计

### 1. 表结构详情

#### （1）林草资源信息表（t_forest_grass_resource）

| 字段名        | 数据类型 | 长度 / 精度 | 约束                                             | 备注                         |
| ------------- | -------- | ----------- | ------------------------------------------------ | ---------------------------- |
| resource_id   | VARCHAR  | 32          | PRIMARY KEY, NOT NULL, UNIQUE                    | 资源编号                     |
| resource_type | VARCHAR  | 16          | NOT NULL                                         | 树木 / 草地                  |
| area_id       | VARCHAR  | 32          | NOT NULL, FOREIGN KEY REFERENCES t_area(area_id) | 区域编号                     |
| variety_name  | VARCHAR  | 64          | NOT NULL                                         | 品种名称                     |
| quantity_area | DECIMAL  | 10,2        | NOT NULL                                         | 树木存数量，草地存面积（㎡） |
| growth_status | VARCHAR  | 16          | NOT NULL                                         | 幼苗 / 成长期 / 成熟期       |
| planting_time | DATE     | -           | NOT NULL                                         | 种植日期                     |
| update_time   | DATETIME | -           | NOT NULL                                         | 最后更新时间                 |

#### （2）资源变动记录表（t_resource_change）

| 字段名        | 数据类型 | 长度 / 精度 | 约束                                                         | 备注                   |
| ------------- | -------- | ----------- | ------------------------------------------------------------ | ---------------------- |
| change_id     | VARCHAR  | 32          | PRIMARY KEY, NOT NULL, UNIQUE                                | 变动编号               |
| resource_id   | VARCHAR  | 32          | NOT NULL, FOREIGN KEY REFERENCES t_forest_grass_resource(resource_id) | 资源编号               |
| change_type   | VARCHAR  | 16          | NOT NULL                                                     | 新增 / 减少 / 状态更新 |
| change_reason | VARCHAR  | 255         | NOT NULL                                                     | 变动原因               |
| change_time   | DATETIME | -           | NOT NULL                                                     | 变动时间               |
| operator_id   | VARCHAR  | 32          | NOT NULL, FOREIGN KEY REFERENCES t_user(user_id)             | 操作人 ID              |

#### （3）区域信息表（t_area）

| 字段名     | 数据类型 | 长度 / 精度 | 约束                                             | 备注        |
| ---------- | -------- | ----------- | ------------------------------------------------ | ----------- |
| area_id    | VARCHAR  | 32          | PRIMARY KEY, NOT NULL, UNIQUE                    | 区域编号    |
| area_name  | VARCHAR  | 64          | NOT NULL                                         | 区域名称    |
| area_type  | VARCHAR  | 16          | NOT NULL                                         | 森林 / 草地 |
| location   | VARCHAR  | 64          | NOT NULL                                         | 经纬度      |
| manager_id | VARCHAR  | 32          | NOT NULL, FOREIGN KEY REFERENCES t_user(user_id) | 负责人 ID   |

#### （4）用户信息表（t_user）

| 字段名   | 数据类型 | 长度 / 精度 | 约束                          | 备注           |
| -------- | -------- | ----------- | ----------------------------- | -------------- |
| user_id  | VARCHAR  | 32          | PRIMARY KEY, NOT NULL, UNIQUE | 用户 ID        |
| username | VARCHAR  | 32          | NOT NULL, UNIQUE              | 用户名         |
| role     | VARCHAR  | 16          | NOT NULL                      | 系统角色       |
| password | VARCHAR  | 64          | NOT NULL                      | 加密存储的密码 |
| contact  | VARCHAR  | 16          | -                             | 联系方式       |

### 2. 索引设计

1. 为 t_forest_grass_resource 的**area_id**建立普通索引，提升按区域查询资源的效率
2. 为 t_resource_change 的**resource_id**和**change_time**建立组合索引，提升按资源 + 时间范围查询变动记录的效率
3. 为 t_area 的**manager_id**建立普通索引，快速定位负责人管辖的区域