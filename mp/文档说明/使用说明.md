智慧林草系统 - 环境监测和统计分析模块使用说明

1. 模块概述

环境监测和统计分析模块是智慧林草系统的核心组成部分，负责采集、存储和分析各种环境数据，为森林和草原资源的保护和管理提供科学依据。

2. 文件结构

```
├── 环境监测和统计分析模块文档.md    # 模块综合文档
├── 环境监测模块需求分析.md          # 模块需求分析文档
├── 环境监测模块表结构.sql           # 数据库表结构设计
├── 环境监测模块角色视图.sql         # 角色视图设计
├── 环境监测模块存储过程触发器.sql    # 存储过程和触发器设计
├── 环境监测模块报表查询.sql         # 报表查询语句
├── environmental_monitoring_mysql.py # 环境监测系统主程序
└── 使用说明.md                      # 本使用说明文档
```

3. Python脚本使用说明

3.1 environmental_monitoring_mysql.py

功能：环境监测和统计分析模块的主程序，负责系统初始化、API服务启动和数据处理。

使用方法：
```bash
python environmental_monitoring_mysql.py
```

说明：
- 自动连接MySQL数据库并初始化数据库结构
- 启动API服务，默认监听在`http://localhost:5000`
- 支持实时数据获取、统计分析、报表生成等功能
- 包含完整的API接口，支持与前端应用集成
- 系统会自动生成初始数据，包括5个环境监测站、5个报表模板和4个系统用户

4. 数据库使用说明

4.1 环境要求

- MySQL 8.0或更高版本
- 具有创建数据库和表的权限

4.2 数据库初始化

1. 创建数据库：
   ```sql
   CREATE DATABASE IF NOT EXISTS smart_forest_grass;
   USE smart_forest_grass;
   ```

2. 执行表结构脚本：
   ```bash
   mysql -u root -p smart_forest_grass < 环境监测模块表结构.sql
   ```

3. 执行视图脚本：
   ```bash
   mysql -u root -p smart_forest_grass < 环境监测模块角色视图.sql
   ```

4. 执行存储过程和触发器脚本：
   ```bash
   mysql -u root -p smart_forest_grass < 环境监测模块存储过程触发器.sql
   ```

4.3 数据库连接信息

- 数据库名称：`smart_forest_grass`
- 字符集：`utf8mb4`
- 排序规则：`utf8mb4_general_ci`

4.4 初始数据

表结构脚本中包含了一些初始数据：
- 5个环境监测站
- 5个报表模板
- 4个系统用户

5. 模块功能使用

5.1 数据统计

存储过程调用：
```sql
-- 按日统计
CALL sp_statistics_daily(CURDATE());

-- 按周统计
CALL sp_statistics_weekly(YEAR(CURDATE()), WEEK(CURDATE()));

-- 按月统计
CALL sp_statistics_monthly(YEAR(CURDATE()), MONTH(CURDATE()));

-- 按季统计
CALL sp_statistics_quarterly(YEAR(CURDATE()), QUARTER(CURDATE()));

-- 按年统计
CALL sp_statistics_yearly(YEAR(CURDATE()));

-- 批量统计
CALL sp_statistics_batch('2023-01-01', '2023-12-31');
```

5.2 异常检测

存储过程调用：
```sql
-- 检测异常数据
CALL sp_detect_abnormal_data();

-- 处理异常数据
CALL sp_process_abnormal_data(1, '已处理', 'admin');
```

5.3 报表生成

存储过程调用：
```sql
-- 生成日报
CALL sp_generate_daily_report(CURDATE());

-- 生成周报
CALL sp_generate_weekly_report(YEAR(CURDATE()), WEEK(CURDATE()));

-- 生成月报
CALL sp_generate_monthly_report(YEAR(CURDATE()), MONTH(CURDATE()));
```

5.4 视图查询

视图查询示例：
```sql
-- 查询实时数据
SELECT * FROM v_realtime_data;

-- 查询环境趋势
SELECT * FROM v_environmental_trend WHERE collection_date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY);

-- 查询空气质量
SELECT * FROM v_air_quality WHERE air_quality_level = '优';

-- 管理员查询所有环境数据
SELECT * FROM v_admin_environmental_data;

-- 普通用户查询环境数据
SELECT * FROM v_user_environmental_data;

-- 访客查询环境数据
SELECT * FROM v_guest_environmental_data;
```

6. 报表查询使用

6.1 日报查询

```sql
SELECT * FROM v_admin_statistical_data WHERE stat_period = '日' AND stat_date = CURDATE();
```

6.2 周报查询

```sql
SELECT * FROM v_admin_statistical_data WHERE stat_period = '周' AND stat_date >= DATE_SUB(CURDATE(), INTERVAL 7 DAY);
```

6.3 月报查询

```sql
SELECT * FROM v_admin_statistical_data WHERE stat_period = '月' AND stat_date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY);
```

6.4 季报查询

```sql
SELECT * FROM v_admin_statistical_data WHERE stat_period = '季' AND stat_date >= DATE_SUB(CURDATE(), INTERVAL 90 DAY);
```

6.5 年报查询

```sql
SELECT * FROM v_admin_statistical_data WHERE stat_period = '年' AND stat_date >= DATE_SUB(CURDATE(), INTERVAL 365 DAY);
```

7. 系统管理

7.1 获取系统状态

```sql
CALL sp_get_system_status();
```

7.2 数据备份

```sql
-- 备份指定日期的数据
CALL sp_backup_data(CURDATE());
```

7.3 数据恢复

```sql
-- 从备份表恢复数据
CALL sp_restore_data(1);
```

7.4 清理历史数据

```sql
-- 清理一年前的数据
CALL sp_clean_history_data(DATE_SUB(CURDATE(), INTERVAL 1 YEAR));
```

8. 常见问题解决

8.1 MySQL命令不可用

问题：在命令行中执行`mysql`命令时提示"无法将'mysql'项识别为cmdlet、函数、脚本文件或可运行程序的名称"。

解决方法：
1. 确保MySQL已安装
2. 将MySQL的bin目录添加到系统PATH环境变量
3. 或使用完整路径执行mysql命令，例如：`C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe`

8.2 python-docx库安装失败

问题：执行`pip install python-docx`时安装失败。

解决方法：
1. 使用国内镜像源：`pip install -i https://pypi.tuna.tsinghua.edu.cn/simple python-docx`

8.3 权限不足

问题：执行SQL脚本时提示权限不足。

解决方法：
1. 使用具有足够权限的MySQL用户
2. 或授予当前用户创建数据库和表的权限：
   ```sql
   GRANT ALL PRIVILEGES ON *.* TO 'username'@'localhost' WITH GRANT OPTION;
   FLUSH PRIVILEGES;
   ```

9. 技术支持

如有问题或建议，请联系：

- 姓名：成员1
- 邮箱：member1@example.com
- 电话：13800138001

10. 更新日志

- 版本 1.0 (2025-12-01)：
  - 完成环境监测和统计分析模块的设计和开发
  - 实现了数据库表结构、视图、存储过程和触发器
  - 编写了完整的使用说明文档
  - 完善了Python脚本，提高了健壮性和易用性

---

文档版本：1.0
文档日期：2025-12-01
文档作者：成员1