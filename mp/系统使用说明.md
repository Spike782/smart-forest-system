# 智慧林草系统 - 环境监测和统计分析模块 使用说明

## 1. 系统概述

### 1.1 系统功能

智慧林草系统 - 环境监测和统计分析模块是一个用于监测和分析森林、草地等环境数据的系统，主要功能包括：

- 区域管理：区域信息的增删改查
- 监测站管理：监测站信息的增删改查
- 传感器管理：传感器信息的增删改查
- 环境数据采集：实时采集和存储环境数据
- 数据统计分析：按日、周、月、季、年统计环境数据
- 异常数据检测：自动检测和记录异常数据
- 报表生成：生成各类环境监测报表
- 用户管理：系统用户的管理和权限控制
- 操作日志：记录系统操作日志

### 1.2 技术栈

- 后端：Python 3.10+
- 数据库：MySQL 8.0+
- Web框架：Flask 2.0+
- 依赖库：pymysql、flask-cors

## 2. 系统安装与配置

### 2.1 环境准备

1. 安装Python 3.10或更高版本
2. 安装MySQL 8.0或更高版本
3. 创建数据库用户和数据库

### 2.2 依赖安装

```bash
pip install -r requirements.txt
```

### 2.3 数据库配置

1. 修改 `environmental_monitoring_mysql.py` 文件中的数据库连接信息：

```python
def __init__(self, host='localhost', user='root', password='your_password', database='smart_forest_grass', port=3306):
```

2. 运行系统，系统会自动创建数据库表结构和初始化数据：

```bash
python environmental_monitoring_mysql.py
```

或者直接执行DDL脚本创建数据库结构：

```bash
mysql -u root -p < ddl.sql
```

## 3. 系统启动与访问

### 3.1 启动系统

```bash
python environmental_monitoring_mysql.py
```

系统启动后，会显示如下信息：

```
正在连接MySQL数据库...
MySQL服务器连接成功
正在初始化数据库结构...
视图创建完成

正在创建存储过程...
存储过程创建完成

正在创建触发器...
触发器创建完成

正在初始化系统数据...
区域信息初始化完成
环境监测站初始化完成
传感器信息初始化完成
报表模板初始化完成
系统用户初始化完成
正在添加模拟环境数据到数据库...
系统数据初始化完成

数据库初始化完成

智慧林草系统 - 环境监测和统计分析模块启动
============================================================
 * Serving Flask app 'environmental_monitoring_mysql' (lazy loading)
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)
```

### 3.2 访问系统

- Web界面：http://127.0.0.1:5000/
- API接口：http://127.0.0.1:5000/api/

## 4. 系统功能使用

### 4.1 数据管理

#### 4.1.1 区域管理

- 新增区域：通过API接口 `POST /api/regions` 新增区域
- 查询区域：通过API接口 `GET /api/regions` 查询所有区域，`GET /api/regions/<region_id>` 查询指定区域
- 更新区域：通过API接口 `PUT /api/regions/<region_id>` 更新指定区域
- 删除区域：通过API接口 `DELETE /api/regions/<region_id>` 删除指定区域

#### 4.1.2 监测站管理

- 新增监测站：通过API接口 `POST /api/stations` 新增监测站
- 查询监测站：通过API接口 `GET /api/stations` 查询所有监测站，`GET /api/stations/<station_id>` 查询指定监测站
- 更新监测站：通过API接口 `PUT /api/stations/<station_id>` 更新指定监测站
- 删除监测站：通过API接口 `DELETE /api/stations/<station_id>` 删除指定监测站

#### 4.1.3 传感器管理

- 新增传感器：通过API接口 `POST /api/sensors` 新增传感器
- 查询传感器：通过API接口 `GET /api/sensors` 查询所有传感器，`GET /api/sensors/<sensor_id>` 查询指定传感器
- 更新传感器：通过API接口 `PUT /api/sensors/<sensor_id>` 更新指定传感器
- 删除传感器：通过API接口 `DELETE /api/sensors/<sensor_id>` 删除指定传感器

### 4.2 数据采集与查询

#### 4.2.1 环境数据采集

系统会自动模拟环境数据采集，也可以通过API接口手动添加环境数据：

- 添加环境数据：通过API接口 `POST /api/environmental_data` 添加环境数据

#### 4.2.2 环境数据查询

- 查询所有环境数据：通过API接口 `GET /api/environmental_data`
- 按条件查询：通过API接口 `GET /api/environmental_data?station_id=1&start_time=2023-01-01&end_time=2023-01-31`
- 查询指定数据：通过API接口 `GET /api/environmental_data/<data_id>`

### 4.3 数据分析与统计

#### 4.3.1 统计分析

- 按日统计：通过API接口 `GET /api/statistics/daily?stat_date=2023-01-01`
- 按周统计：通过API接口 `GET /api/statistics/weekly?year=2023&week=1`
- 按月统计：通过API接口 `GET /api/statistics/monthly?year=2023&month=1`
- 按季统计：通过API接口 `GET /api/statistics/quarterly?year=2023&quarter=1`
- 按年统计：通过API接口 `GET /api/statistics/yearly?year=2023`

#### 4.3.2 异常数据管理

- 查询异常数据：通过API接口 `GET /api/abnormal_data`
- 处理异常数据：通过API接口 `PUT /api/abnormal_data/<abnormal_id>` 更新异常数据状态

### 4.4 报表生成

- 生成日报：通过API接口 `POST /api/reports/daily?report_date=2023-01-01`
- 生成周报：通过API接口 `POST /api/reports/weekly?year=2023&week=1`
- 生成月报：通过API接口 `POST /api/reports/monthly?year=2023&month=1`
- 查询报表：通过API接口 `GET /api/reports`

### 4.5 系统管理

#### 4.5.1 用户管理

- 新增用户：通过API接口 `POST /api/users` 新增用户
- 查询用户：通过API接口 `GET /api/users` 查询所有用户，`GET /api/users/<user_id>` 查询指定用户
- 更新用户：通过API接口 `PUT /api/users/<user_id>` 更新指定用户
- 删除用户：通过API接口 `DELETE /api/users/<user_id>` 删除指定用户

#### 4.5.2 操作日志查询

- 查询操作日志：通过API接口 `GET /api/operation_logs`
- 按条件查询：通过API接口 `GET /api/operation_logs?user_id=1&start_time=2023-01-01&end_time=2023-01-31`

## 5. API接口文档

### 5.1 区域管理

#### 5.1.1 获取所有区域

- **URL**: `/api/regions`
- **Method**: `GET`
- **Response**: JSON格式的区域列表

#### 5.1.2 获取指定区域

- **URL**: `/api/regions/<region_id>`
- **Method**: `GET`
- **Response**: JSON格式的区域信息

#### 5.1.3 新增区域

- **URL**: `/api/regions`
- **Method**: `POST`
- **Request Body**: JSON格式的区域信息
- **Response**: JSON格式的新增区域信息

#### 5.1.4 更新区域

- **URL**: `/api/regions/<region_id>`
- **Method**: `PUT`
- **Request Body**: JSON格式的区域信息
- **Response**: JSON格式的更新后区域信息

#### 5.1.5 删除区域

- **URL**: `/api/regions/<region_id>`
- **Method**: `DELETE`
- **Response**: JSON格式的删除结果

### 5.2 监测站管理

#### 5.2.1 获取所有监测站

- **URL**: `/api/stations`
- **Method**: `GET`
- **Response**: JSON格式的监测站列表

#### 5.2.2 获取指定监测站

- **URL**: `/api/stations/<station_id>`
- **Method**: `GET`
- **Response**: JSON格式的监测站信息

#### 5.2.3 新增监测站

- **URL**: `/api/stations`
- **Method**: `POST`
- **Request Body**: JSON格式的监测站信息
- **Response**: JSON格式的新增监测站信息

#### 5.2.4 更新监测站

- **URL**: `/api/stations/<station_id>`
- **Method**: `PUT`
- **Request Body**: JSON格式的监测站信息
- **Response**: JSON格式的更新后监测站信息

#### 5.2.5 删除监测站

- **URL**: `/api/stations/<station_id>`
- **Method**: `DELETE`
- **Response**: JSON格式的删除结果

### 5.3 传感器管理

#### 5.3.1 获取所有传感器

- **URL**: `/api/sensors`
- **Method**: `GET`
- **Response**: JSON格式的传感器列表

#### 5.3.2 获取指定传感器

- **URL**: `/api/sensors/<sensor_id>`
- **Method**: `GET`
- **Response**: JSON格式的传感器信息

#### 5.3.3 新增传感器

- **URL**: `/api/sensors`
- **Method**: `POST`
- **Request Body**: JSON格式的传感器信息
- **Response**: JSON格式的新增传感器信息

#### 5.3.4 更新传感器

- **URL**: `/api/sensors/<sensor_id>`
- **Method**: `PUT`
- **Request Body**: JSON格式的传感器信息
- **Response**: JSON格式的更新后传感器信息

#### 5.3.5 删除传感器

- **URL**: `/api/sensors/<sensor_id>`
- **Method**: `DELETE`
- **Response**: JSON格式的删除结果

### 5.4 环境数据管理

#### 5.4.1 获取所有环境数据

- **URL**: `/api/environmental_data`
- **Method**: `GET`
- **Params**: `station_id`, `start_time`, `end_time`
- **Response**: JSON格式的环境数据列表

#### 5.4.2 获取指定环境数据

- **URL**: `/api/environmental_data/<data_id>`
- **Method**: `GET`
- **Response**: JSON格式的环境数据信息

#### 5.4.3 新增环境数据

- **URL**: `/api/environmental_data`
- **Method**: `POST`
- **Request Body**: JSON格式的环境数据信息
- **Response**: JSON格式的新增环境数据信息

### 5.5 统计数据管理

#### 5.5.1 获取日统计数据

- **URL**: `/api/statistics/daily`
- **Method**: `GET`
- **Params**: `stat_date`
- **Response**: JSON格式的日统计数据列表

#### 5.5.2 获取周统计数据

- **URL**: `/api/statistics/weekly`
- **Method**: `GET`
- **Params**: `year`, `week`
- **Response**: JSON格式的周统计数据列表

#### 5.5.3 获取月统计数据

- **URL**: `/api/statistics/monthly`
- **Method**: `GET`
- **Params**: `year`, `month`
- **Response**: JSON格式的月统计数据列表

#### 5.5.4 获取季统计数据

- **URL**: `/api/statistics/quarterly`
- **Method**: `GET`
- **Params**: `year`, `quarter`
- **Response**: JSON格式的季统计数据列表

#### 5.5.5 获取年统计数据

- **URL**: `/api/statistics/yearly`
- **Method**: `GET`
- **Params**: `year`
- **Response**: JSON格式的年统计数据列表

### 5.6 异常数据管理

#### 5.6.1 获取所有异常数据

- **URL**: `/api/abnormal_data`
- **Method**: `GET`
- **Response**: JSON格式的异常数据列表

#### 5.6.2 处理异常数据

- **URL**: `/api/abnormal_data/<abnormal_id>`
- **Method**: `PUT`
- **Request Body**: JSON格式的异常数据处理信息
- **Response**: JSON格式的处理结果

### 5.7 报表管理

#### 5.7.1 生成日报

- **URL**: `/api/reports/daily`
- **Method**: `POST`
- **Params**: `report_date`
- **Response**: JSON格式的生成结果

#### 5.7.2 生成周报

- **URL**: `/api/reports/weekly`
- **Method**: `POST`
- **Params**: `year`, `week`
- **Response**: JSON格式的生成结果

#### 5.7.3 生成月报

- **URL**: `/api/reports/monthly`
- **Method**: `POST`
- **Params**: `year`, `month`
- **Response**: JSON格式的生成结果

#### 5.7.4 获取所有报表

- **URL**: `/api/reports`
- **Method**: `GET`
- **Response**: JSON格式的报表列表

### 5.8 用户管理

#### 5.8.1 获取所有用户

- **URL**: `/api/users`
- **Method**: `GET`
- **Response**: JSON格式的用户列表

#### 5.8.2 获取指定用户

- **URL**: `/api/users/<user_id>`
- **Method**: `GET`
- **Response**: JSON格式的用户信息

#### 5.8.3 新增用户

- **URL**: `/api/users`
- **Method**: `POST`
- **Request Body**: JSON格式的用户信息
- **Response**: JSON格式的新增用户信息

#### 5.8.4 更新用户

- **URL**: `/api/users/<user_id>`
- **Method**: `PUT`
- **Request Body**: JSON格式的用户信息
- **Response**: JSON格式的更新后用户信息

#### 5.8.5 删除用户

- **URL**: `/api/users/<user_id>`
- **Method**: `DELETE`
- **Response**: JSON格式的删除结果

### 5.9 操作日志管理

#### 5.9.1 获取所有操作日志

- **URL**: `/api/operation_logs`
- **Method**: `GET`
- **Params**: `user_id`, `start_time`, `end_time`
- **Response**: JSON格式的操作日志列表

## 6. 系统维护与故障排除

### 6.1 常见问题

1. **数据库连接失败**
   - 检查数据库服务是否启动
   - 检查数据库连接参数是否正确
   - 检查数据库用户权限是否足够

2. **API接口访问失败**
   - 检查系统是否正常运行
   - 检查API接口URL是否正确
   - 检查请求方法和参数是否正确

3. **数据采集失败**
   - 检查传感器状态是否正常
   - 检查监测站状态是否正常
   - 检查网络连接是否正常

### 6.2 日志管理

系统运行日志存储在 `debug.log` 文件中，可以通过查看日志文件排查故障。

## 7. 系统更新与升级

### 7.1 代码更新

1. 备份现有代码和数据
2. 替换新代码
3. 运行数据库更新脚本（如果有）
4. 重启系统

### 7.2 数据库更新

如果数据库结构发生变化，需要运行更新脚本：

```bash
mysql -u root -p < update.sql
```

## 8. 安全注意事项

1. 定期备份数据库
2. 定期更新系统和依赖库
3. 限制数据库用户权限
4. 配置防火墙，限制API接口访问
5. 启用HTTPS（生产环境）
6. 定期检查系统日志，发现异常及时处理

## 9. 联系方式

如有问题或建议，请联系系统管理员。

---

**智慧林草系统 - 环境监测和统计分析模块**
**版本：1.0**
**更新日期：2025-12-28**
